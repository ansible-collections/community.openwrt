# Copyright (c) 2026, Alexei Znamensky (@russoz)
# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)
# SPDX-License-Identifier: GPL-3.0-or-later

---
- name: "Gather system facts"
  community.openwrt.setup:
  register: setup_result

- name: Pring facts
  ansible.builtin.debug:
    var: setup_result

- name: Assert setup gathered facts
  ansible.builtin.assert:
    that:
      - setup_result is succeeded
      - setup_result.ansible_facts is defined

- name: Assert ansible_os_family is defined
  ansible.builtin.assert:
    that:
      - setup_result.ansible_facts.ansible_os_family is defined

- name: Assert date/time facts
  vars:
    dt: "{{ setup_result.ansible_facts.ansible_date_time }}"
  ansible.builtin.assert:
    that:
      - dt is defined
      - dt.date == "{{ dt.year }}-{{ dt.month }}-{{ dt.day }}"
      - dt.time == "{{ dt.hour }}-{{ dt.minute }}-{{ second }}"
      - dt.iso8601_basic_short == {{ dt.year }}-{{ dt.month }}-{{ dt.day }}T{{ dt.hour }}-{{ dt.minute }}-{{ second }}"
      - dt.epoch == dt.epoch_int
      - dt.tz == dt.tz_dst
      - dt.date is ansible.builtin.match("\d\d\d\d-\d\d-\d\d")
