

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Community OpenWrt User Guide &mdash; Community.OpenWrt Collection  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=41de9001" />
      <link rel="stylesheet" type="text/css" href="../_static/css/ansible.css?v=b54c304f" />
      <link rel="stylesheet" type="text/css" href="../_static/antsibull-minimal.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/rtd-ethical-ads.css?v=289b023e" />

  
    <link rel="shortcut icon" href="../_static/images/Ansible-Mark-RGB_Black.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=7f41d439"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Community OpenWrt Migration Guide" href="migration_guide.html" />
    <link rel="prev" title="Community.Openwrt" href="../index.html" /><!-- extra head elements for Ansible beyond RTD Sphinx Theme -->




</head>

<body class="wy-body-for-nav"><!-- extra body elements for Ansible beyond RTD Sphinx Theme -->

<div class="DocSite-globalNav ansibleNav">
  <ul>
    <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
    <li><a href="https://forum.ansible.com/" target="_blank">Ansible community forum</a></li>
    <li><a href="https://docs.ansible.com/" target="_blank">Documentation</a></li>
  </ul>
</div>

<a class="DocSite-nav" href="https://ansible-collections.github.io/community.openwrt/branch/main/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/Ansible-Mark-RGB_White.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">Community.OpenWrt Collection Docs</div>
</a>
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Community.OpenWrt Collection
          </a><!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    
  
</div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <label class="sr-only" for="q">Search docs:</label>
    <input type="text" class="st-default-search-input" id="q" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Community OpenWrt User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#additional-packages">Additional packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#openwrt-control-variables">OpenWrt control variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-community-openwrt">Using community.openwrt</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialization">Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modules">Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handlers">Handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#facts">Facts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="migration_guide.html">Community OpenWrt Migration Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mod_dev_guide.html">Community OpenWrt Module Developer Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apk_module.html">community.openwrt.apk module – Manage packages with apk on OpenWrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_module.html">community.openwrt.command module – Execute commands on OpenWrt targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../copy_module.html">community.openwrt.copy module – Copy files to remote OpenWrt devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../file_module.html">community.openwrt.file module – Manage files and file properties on OpenWrt targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lineinfile_module.html">community.openwrt.lineinfile module – Manage lines in text files on OpenWrt targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nohup_module.html">community.openwrt.nohup module – Starts a command in background and returns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../opkg_module.html">community.openwrt.opkg module – Manage packages with opkg on OpenWrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ping_module.html">community.openwrt.ping module – Verify ability to communicate with OpenWrt targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../service_module.html">community.openwrt.service module – Manage services on OpenWrt targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup_module.html">community.openwrt.setup module – Gather facts about OpenWrt systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slurp_module.html">community.openwrt.slurp module – Slurps a file from remote OpenWrt nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stat_module.html">community.openwrt.stat module – Retrieve file or file system status on OpenWrt targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sysctl_module.html">community.openwrt.sysctl module – Manage sysctl entries on OpenWrt targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uci_module.html">community.openwrt.uci module – Controls OpenWrt UCI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wrapper_module.html">community.openwrt.wrapper module – Internal wrapper module for OpenWrt shell-based modules</a></li>
</ul>
<!-- extra nav elements for Ansible beyond RTD Sphinx Theme -->

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Community.OpenWrt Collection</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Community OpenWrt User Guide</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

  
           <div itemprop="articleBody">
             
  <section id="community-openwrt-user-guide">
<span id="ansible-collections-community-openwrt-docsite-user-guide"></span><h1>Community OpenWrt User Guide<a class="headerlink" href="#community-openwrt-user-guide" title="Link to this heading"></a></h1>
<p>Welcome to the Community OpenWrt User Guide! If you are reading this, it’s likely that you own
or manage OpenWrt routers and you would like to use Ansible to manage them.
As you may well know, some devices have limitations of resources, preventing Python from being installed.</p>
<p>This collection is based on the Ansible role <code class="docutils literal notranslate"><span class="pre">gekmihesg.openwrt</span></code> and as such it does not require Python
installed on the OpenWrt devices - all the code is written in plain shell scripts.
If you have been using <code class="docutils literal notranslate"><span class="pre">gekmihesg.openwrt</span></code> before and want to move to <code class="docutils literal notranslate"><span class="pre">community.openwrt</span></code>,
please check the <a class="reference internal" href="migration_guide.html#ansible-collections-community-openwrt-docsite-migration-guide"><span class="std std-ref">Community OpenWrt Migration Guide</span></a>.</p>
<section id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading"></a></h2>
<p>To get started with <code class="docutils literal notranslate"><span class="pre">community.openwrt</span></code> you can simply run a playbook like:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">routers</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">community.openwrt.init</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gather OpenWrt facts</span>
<span class="w">      </span><span class="nt">community.openwrt.setup</span><span class="p">:</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install a package</span>
<span class="w">      </span><span class="nt">community.openwrt.opkg</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">luci</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure UCI settings</span>
<span class="w">      </span><span class="nt">community.openwrt.uci</span><span class="p">:</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">set</span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system.@system[0].hostname</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myrouter</span>
</pre></div>
</div>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Link to this heading"></a></h2>
<p>Check the collection’s <a class="reference external" href="https://github.com/ansible-collections/community.openwrt?tab=readme-ov-file">README</a>
for the supported versions of Ansible and OpenWrt.</p>
<p>The modules in this collection are all written in shell script (more specifically <code class="docutils literal notranslate"><span class="pre">ash</span></code>, used in OpenWrt devices). The control node requires Python.</p>
<p>This collection is tested using OpenWrt container images for the <code class="docutils literal notranslate"><span class="pre">x86_64</span></code> architecture.</p>
<section id="additional-packages">
<h3>Additional packages<a class="headerlink" href="#additional-packages" title="Link to this heading"></a></h3>
<p>To provide some specific features, additional packages are required in the OpenWrt devices:</p>
<blockquote>
<div><dl class="simple">
<dt>coreutils-sha1sum</dt><dd><p>Required for any module that uses/provides SHA1 hashes.</p>
</dd>
<dt>coreutils-base64</dt><dd><p>Used to improve the performance of modules that manipulate content using the Base64 encoding.</p>
</dd>
</dl>
</div></blockquote>
<p>The installation of those packages is performed by the <code class="docutils literal notranslate"><span class="pre">community.openwrt.init</span></code> role.</p>
</section>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<section id="openwrt-control-variables">
<h3>OpenWrt control variables<a class="headerlink" href="#openwrt-control-variables" title="Link to this heading"></a></h3>
<p>These variables control Ansible behavior:</p>
<blockquote>
<div><dl class="simple">
<dt>openwrt_scp_if_ssh:</dt><dd><p>Whether to use <code class="docutils literal notranslate"><span class="pre">scp</span></code> instead of <code class="docutils literal notranslate"><span class="pre">sftp</span></code> for OpenWrt systems (sets <code class="docutils literal notranslate"><span class="pre">ansible_scp_if_ssh</span></code>).
Value can be <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code> or <code class="docutils literal notranslate"><span class="pre">smart</span></code>. (default: <code class="docutils literal notranslate"><span class="pre">smart</span></code>)</p>
</dd>
<dt>openwrt_remote_tmp:</dt><dd><p>Ansibles <code class="docutils literal notranslate"><span class="pre">remote_tmp</span></code> (sets <code class="docutils literal notranslate"><span class="pre">ansible_remote_tmp</span></code>) setting for OpenWrt systems.
Setting to <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> helps prevent flash wear on target device. (default: <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>)</p>
</dd>
</dl>
</div></blockquote>
<p>This variable is used when including the <code class="docutils literal notranslate"><span class="pre">community.openwrt.init</span></code> role:</p>
<blockquote>
<div><dl class="simple">
<dt>openwrt_install_recommended_packages:</dt><dd><p>Checks for some commands and installs the corresponding packages if they are
missing. See the item above. (default: <code class="docutils literal notranslate"><span class="pre">true</span></code>)</p>
</dd>
</dl>
</div></blockquote>
<p>These variables are used by the handlers defined in the collection:</p>
<blockquote>
<div><dl class="simple">
<dt>openwrt_wait_for_connection, openwrt_wait_for_connection_timeout:</dt><dd><p>Whether to wait for the host (default: <code class="docutils literal notranslate"><span class="pre">true</span></code>) and how long (default: <code class="docutils literal notranslate"><span class="pre">300</span></code>) after a
network or wifi restart (see handlers below).</p>
</dd>
</dl>
</div></blockquote>
<p>These variables are created as convenience to perform some specific tasks:</p>
<blockquote>
<div><dl class="simple">
<dt>openwrt_ssh, openwrt_scp, openwrt_ssh_host, openwrt_ssh_user, openwrt_user_host:</dt><dd><p>Helper shortcuts to do things like
<code class="docutils literal notranslate"><span class="pre">command:</span> <span class="pre">{{</span> <span class="pre">openwrt_scp</span> <span class="pre">}}</span> <span class="pre">{{</span> <span class="pre">openwrt_user_host|quote</span> <span class="pre">}}:/etc/rc.local</span> <span class="pre">/tmp</span></code></p>
</dd>
</dl>
</div></blockquote>
<p>These variables are set when (or before) executing the <code class="docutils literal notranslate"><span class="pre">community.openwrt.init</span></code> role.</p>
</section>
</section>
<section id="using-community-openwrt">
<h2>Using community.openwrt<a class="headerlink" href="#using-community-openwrt" title="Link to this heading"></a></h2>
<section id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Link to this heading"></a></h3>
<p>The collection provides the role <code class="docutils literal notranslate"><span class="pre">community.openwrt.init</span></code> that should be included before using the modules.
Although the use of this role is not strictly necessary, it is <strong>strongly recommended</strong> that you do so.
The <code class="docutils literal notranslate"><span class="pre">init</span></code> role:</p>
<ul class="simple">
<li><p>Installs additional packages</p></li>
<li><p>Sets variables controlling the behavior of the modules</p></li>
<li><p>Register notification handlers</p></li>
</ul>
<p>You can use it like any other role and you should use it before using any module from this collection.</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Init community.openwrt</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">openwrt_install_recommended_packages</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">ansible.builtin.import_role</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">community.openwrt.init</span>
</pre></div>
</div>
</section>
<section id="modules">
<h3>Modules<a class="headerlink" href="#modules" title="Link to this heading"></a></h3>
<p>Many modules in this collection mimic (to some extent) their counterpart modules in <code class="docutils literal notranslate"><span class="pre">ansible.builtin</span></code>, for example: <code class="docutils literal notranslate"><span class="pre">community.openwrt.copy</span></code>,
<code class="docutils literal notranslate"><span class="pre">community.openwrt.command</span></code>, <code class="docutils literal notranslate"><span class="pre">community.openwrt.slurp</span></code>, etc, whilst other modules are specific to OpenWrt: <code class="docutils literal notranslate"><span class="pre">community.openwrt.opkg</span></code>,
<code class="docutils literal notranslate"><span class="pre">community.openwrt.nohup</span></code>, etc.</p>
<p>You can find the detailed documentation for each module on the
<a class="reference external" href="https://galaxy.ansible.com/ui/repo/published/community/openwrt/">community.openwrt collection page in Ansible Galaxy</a>.</p>
</section>
<section id="handlers">
<h3>Handlers<a class="headerlink" href="#handlers" title="Link to this heading"></a></h3>
<p>The collection providers some standard handlers you can use in your playbooks:</p>
<blockquote>
<div><dl class="simple">
<dt>Setup wifi</dt><dd><p>Runs <code class="docutils literal notranslate"><span class="pre">/sbin/wifi</span></code> to setup WiFi</p>
</dd>
<dt>Reload wifi</dt><dd><p>Runs <code class="docutils literal notranslate"><span class="pre">/sbin/wifi</span> <span class="pre">reload</span></code> to reload WiFi configuration</p>
</dd>
<dt>Restart network</dt><dd><p>Restarts the network service</p>
</dd>
<dt>Wait for connection</dt><dd><p>Waits for the device to come back online after network changes</p>
</dd>
</dl>
</div></blockquote>
<p>Example usage:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure wireless</span>
<span class="w">  </span><span class="nt">community.openwrt.uci</span><span class="p">:</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">set</span>
<span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wireless.radio0.channel</span>
<span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;6&quot;</span>
<span class="w">  </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reload wifi</span>
</pre></div>
</div>
<p>These handlers are actually defined in another role called <code class="docutils literal notranslate"><span class="pre">community.openwrt.common</span></code>,
but they are made available when <code class="docutils literal notranslate"><span class="pre">community.openwrt.init</span></code> is executed.</p>
</section>
<section id="facts">
<h3>Facts<a class="headerlink" href="#facts" title="Link to this heading"></a></h3>
<p>In playbooks <code class="docutils literal notranslate"><span class="pre">gather_facts=true</span></code> will <strong>always</strong> try to run Python in the target node.
Because of that, it is recommended that you disable
<a class="reference external" href="https://docs.ansible.com/projects/ansible/latest/reference_appendices/config.html#default-gathering">default fact gathering</a>
in your <code class="docutils literal notranslate"><span class="pre">ansible.cfg</span></code> file, or make sure to always set <code class="docutils literal notranslate"><span class="pre">gather_facts=false</span></code>.</p>
<p>That being said, you can retrieve facts from your OpenWrt device using the module <code class="docutils literal notranslate"><span class="pre">community.openwrt.setup</span></code>.
It is as easy as:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Gather OpenWrt facts</span>
<span class="w">  </span><span class="nt">community.openwrt.setup</span><span class="p">:</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.3.0.</span></p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          

<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Community.Openwrt" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="migration_guide.html" class="btn btn-neutral float-right" title="Community OpenWrt Migration Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Community.OpenWrt Contributors.</p>
  </div>

  
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script><!-- extra footer elements for Ansible beyond RTD Sphinx Theme -->

</body>
</html>